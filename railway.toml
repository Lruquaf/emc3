# Railway Configuration for e=mc³ API
# Bu dosya Railway'de otomatik deployment ve migration için kullanılır

[build]
# Build komutu - monorepo için
# ÖNEMLİ: Önce shared package'ı build et, sonra Prisma generate, sonra API build
builder = "NIXPACKS"
buildCommand = "pnpm install && pnpm build:api:deploy"

[deploy]
# Start komutu - Migration'ları çalıştırıp API'yi başlatmak için
# Prisma migrate deploy idempotent'tir (aynı migration'ı tekrar çalıştırmak sorun yaratmaz)
startCommand = "cd apps/api && pnpm start:deploy"

# Health check endpoint
healthcheckPath = "/api/v1/health"
healthcheckTimeout = 100

# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# ═══════════════════════════════════════════════════════════
# Otomatik Migration Hook
# ═══════════════════════════════════════════════════════════
# Railway deployment sonrası otomatik olarak migration'ları çalıştırır
[deploy.hooks]
# Post-deploy hook - Build ve deployment sonrası çalışır
postdeploy = "cd apps/api && pnpm db:generate && pnpm db:migrate"

# ═══════════════════════════════════════════════════════════
# Environment Variables (Opsiyonel - Railway dashboard'dan da eklenebilir)
# ═══════════════════════════════════════════════════════════
# Not: Hassas bilgileri (JWT_SECRET, API keys) Railway dashboard'dan ekleyin
# Burada sadece genel ayarları belirtebilirsiniz

[env]
NODE_ENV = "staging"
PORT = "3000"
RATE_LIMIT_ENABLED = "true"
